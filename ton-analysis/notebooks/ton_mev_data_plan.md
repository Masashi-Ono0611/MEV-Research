# TON内MEVデータ取得・初期分析方針（24hスナップショット）

## 目的
- STON.fiのUSDT<>TONペアを対象に、直近24時間でサンドイッチ等の有害MEVの有無と規模を掴む。
- スリッページ分布や遅延を簡易に測り、問題の有無を可視化する。

## 取得対象（最小セット）
1. **スワップログ（USDT<>TON on STON.fi）**
   - tx hash, block高さ, timestamp, sender, amount_in/out, 取得できればプール状態（before/after）。
   - 用途: サンドイッチ検知、スリッページ分布、トレードサイズ分布。
2. **ブロックメタデータ**
   - block高さ, timestamp, proposer/validator/builder（判明分）, tx数。
   - 用途: 送信→含まれる遅延、集中度の粗い把握。
3. **送信時刻（可能なら）**
   - 用途: 送信→含まれるまでの秒数分布、並び替え兆候。
4. **リファレンス価格**
   - TON/USDTの外部価格（CEXや他DEX）。
   - 用途: 公正価格推定、サンドイッチ時の価格乖離確認。

## 指標・検知
- サンドイッチ疑い: スワップ前後に逆→同方向の近接txがあり、被害者の実効価格が悪化。
- スリッページ分布: 期待レートとの差分を集計。
- 遅延: 送信時刻が取れれば送信→含まれる秒数の分布。
- 集中度（簡易）: 24hの提案者/ビルダー分布。

### TONにおけるMEV手段の前提
- **ガス入札競争（GPA）**: 事実上なし。ガスを積んで順番を奪う手段は使えない。
- **到達競争（低レイテンシ/特定ピア経由）**: 可能。提案者が「先に受信したTXを優先」するなら、早押しで前に入れる余地がある。
- **提案者による並べ替え**: 可能。提案者はブロック内の順序を決める裁量があり、自身のTXや任意の順を先頭に置ける（有効性・ブロック制約を満たす範囲で）。

#### チェーン別ざっくり比較
- **Ethereum**: GPAあり（tip競争）。到達競争あり。提案者/ビルダー並べ替え余地あり（MEV-Boost/PBS系）。
- **Solana**: 優先手数料で実質GPA的競争あり。到達競争あり。リーダー裁量で並べ替え余地あり。
- **TON**: GPAなし。到達競争あり。提案者裁量で並べ替え余地あり。

## 範囲
- 期間: 直近24時間に限定。
- ペア: STON.fi USDT<>TON のみ（初回スコープ縮小）。
- 対象ルーターアドレス: [`EQCS4UEa5UaJLzOyyKieqQOQ2P9M-7kXpkO5HnP3Bv250cN3`](https://tonviewer.com/EQCS4UEa5UaJLzOyyKieqQOQ2P9M-7kXpkO5HnP3Bv250cN3)（STON.fi DEX, stonfi_router_v2）。
  - 参考: 他候補 `EQBSNX_5mSikBVttWhIaIb0f8jJU7fL6kvyyFVppd7dWRO6M`（stonfi_router_v2, *USDe専用）、`EQB3ncyBUTjZUA5EnFKR5_EnOMI9V1tTEAAPaiU71gc4TiUt`（stonfi_router）。

## 理由（この粒度で始めるワケ）
- 初回から広げるとデータ量・実装コストが膨らむため、1ペア・24hで有害MEVの兆候をまず確認する。
- 問題が見えたら他ペアや期間、ブリッジ経路に拡張する。

## 次のステップ案
- スワップログ取得スクリプト雛形を作成し、24hデータをpull。
- サンドイッチ簡易検知とスリッページ分布を算出。
- ブロックメタと突合し、遅延・集中度をざっくり算出し可視化。
